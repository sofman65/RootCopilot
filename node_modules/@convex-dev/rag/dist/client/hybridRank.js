/**
 * Rank results from multiple results, e.g. from vector search and text search.
 * Uses the "Recriprocal Rank Fusion" algorithm.
 * @param sortedResults The results arrays ordered by most important first.
 */
export function hybridRank(sortedResults, opts) {
    const k = opts?.k ?? 10;
    const scores = new Map();
    for (const [i, results] of sortedResults.entries()) {
        const weight = opts?.weights?.[i] ?? 1;
        for (let j = 0; j < results.length; j++) {
            const key = results[j];
            scores.set(key, (scores.get(key) ?? 0) + weight / (k + j));
        }
    }
    const sortedScores = Array.from(scores.entries()).sort((a, b) => b[1] - a[1]);
    return sortedScores
        .filter(([_, score]) => score >= (opts?.cutoffScore ?? 0))
        .map(([key]) => key);
}
//# sourceMappingURL=hybridRank.js.map